<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dispatch System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Segoe UI;
  background:#0b1e35;
  color:white;
}
header{
  background:#132c4d;
  padding:15px;
  font-size:20px;
}
.container{
  display:flex;
  height:100vh;
}
.sidebar{
  width:250px;
  background:#132c4d;
  padding:10px;
}
.sidebar button{
  width:100%;
  margin:5px 0;
  padding:10px;
  background:#1f3f66;
  border:none;
  color:white;
  cursor:pointer;
}
.sidebar button:hover{
  background:#29598f;
}
.main{
  flex:1;
  padding:20px;
  overflow:auto;
}
.card{
  background:#1f3f66;
  padding:12px;
  margin:10px 0;
  border-radius:6px;
}
input{
  width:100%;
  padding:8px;
  margin:6px 0;
}
button.action{
  background:#0074D9;
  color:white;
  border:none;
  padding:10px;
  cursor:pointer;
  width:100%;
}
</style>
</head>

<body>

<header>ðŸš¨ Emergency Dispatch System</header>

<div class="container">

<div class="sidebar">
<button onclick="show('login')">Sign In</button>
<button onclick="show('contacts')">Contacts</button>
</div>

<div class="main">

<section id="login">
<h2>Responder Sign In</h2>

<input id="name" placeholder="Responder Name">
<input id="vehicleMakeModel" placeholder="Vehicle Make & Model">
<input id="vehicleColour" placeholder="Vehicle Colour">
<input id="registration" placeholder="Vehicle Registration">

<button class="action" onclick="signIn()">Sign In</button>
</section>

<section id="contacts" style="display:none">
<h2>Active Responders</h2>
<div id="contactList"></div>
</section>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ðŸ”´ REPLACE WITH YOUR REAL FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCcbMg_BxDkvCFPvzyC_qDxr5tmb3IRhzk",
    authDomain: "oesf-e7a8e.firebaseapp.com",
    projectId: "oesf-e7a8e",
    storageBucket: "oesf-e7a8e.firebasestorage.app",
    messagingSenderId: "844363489759",
    appId: "1:844363489759:web:2b56fe51cc28053dbe246a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentUser = null;

/* Navigation */
window.show = function(id){
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* Sign In */
window.signIn = async function(){

  if(!name.value || !vehicleMakeModel.value || !vehicleColour.value || !registration.value){
    alert("Please complete all fields.");
    return;
  }

  currentUser = {
    name: name.value,
    vehicleMakeModel: vehicleMakeModel.value,
    vehicleColour: vehicleColour.value,
    registration: registration.value,
    status: "Available",
    signedInAt: Date.now()
  };

  try{
    await addDoc(collection(db,"units"), currentUser);
    alert("Signed in successfully as " + currentUser.name);
    show("contacts");
  }
  catch(error){
    console.error(error);
    alert("Error signing in. Check console.");
  }
}

/* Live Contacts */
onSnapshot(collection(db,"units"), snapshot=>{
  const div = document.getElementById("contactList");
  div.innerHTML = "";

  snapshot.forEach(doc=>{
    const u = doc.data();

    div.innerHTML += `
      <div class="card">
        <b>${u.name}</b><br>
        Vehicle: ${u.vehicleMakeModel}<br>
        Colour: ${u.vehicleColour}<br>
        Registration: ${u.registration}<br>
        Status: ${u.status}
      </div>
    `;
  });
});

show("login");

</script>

</body>
</html>
