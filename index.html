<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Incident Command Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Segoe UI;background:#0b1e35;color:white}
header{background:#132c4d;padding:15px;font-size:20px}
.container{display:flex;height:100vh}
.sidebar{width:250px;background:#132c4d;padding:10px}
.sidebar button{width:100%;margin:6px 0;padding:10px;background:#1f3f66;border:none;color:white;cursor:pointer}
.sidebar button:hover{background:#29598f}
.main{flex:1;padding:20px;overflow:auto}
.card{background:#1f3f66;padding:12px;margin:10px 0;border-radius:6px}
input,select,textarea{width:100%;padding:8px;margin:6px 0}
button{border:none;padding:6px 10px;margin:3px;cursor:pointer}
.orange{background:orange;color:white}
.blue{background:#0099ff;color:white}
.red{background:#cc0000;color:white}
.green{background:green;color:white}
.closeBtn{background:#444;color:white}
.timer{color:#00e5ff;font-weight:bold}
a.mapLink{color:#00e5ff;text-decoration:none;font-weight:bold}
a.mapLink:hover{text-decoration:underline}
.sectionTitle{margin-top:25px;border-bottom:1px solid #29598f;padding-bottom:5px}
.responder{margin-left:10px;}
.responder b{color:#00e5ff;}
</style>
</head>

<body>

<header>ðŸš¨ Incident Command Center</header>

<div class="container">

<div class="sidebar">
<button onclick="show('dashboard')">Dashboard</button>
<button onclick="show('createIncident')">Create Incident</button>
</div>

<div class="main">

<section id="dashboard" style="display:block">
<h2 class="sectionTitle">Active Incidents</h2>
<div id="incidentBoard"></div>

<h2 class="sectionTitle">Completed Incidents</h2>
<div id="completedBoard"></div>
</section>

<section id="createIncident" style="display:none">
<h2>Create Incident</h2>
<input id="address" placeholder="Address">
<input id="description" placeholder="Description">
<input id="contact" placeholder="Contact On Scene">
<select id="priority">
<option>Low</option>
<option>Medium</option>
<option>High</option>
<option>Critical</option>
</select>
<button onclick="createIncident()">Create Incident</button>
</section>

</div>
</div>

<script>
let incidents=[];
let responders=["Responder1","Responder2","Responder3"]; // example responders

function show(id){
document.querySelectorAll("section").forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
}

// Create incident
function createIncident(){
if(!address.value || !description.value){ alert("Enter address and description"); return; }
const incident={
id:Date.now(),
address:address.value,
description:description.value,
contact:contact.value,
priority:priority.value,
created:Date.now(),
status:"Active",
responders:[],
completed:false
};
incidents.unshift(incident); // newest first
renderIncidents();
address.value=""; description.value=""; contact.value="";
show("dashboard");
}

// Assign responder and update status
function responderStatus(incidentId,responder,status){
const inc=incidents.find(i=>i.id===incidentId);
if(!inc) return;

// Check if responder already assigned
let r=inc.responders.find(x=>x.name===responder);
if(!r){
r={name:responder,status:"Responding",start:Date.now(),elapsed:0,commander:false};
inc.responders.push(r);
}

// First to go On Scene â†’ Commander
if(status==="On Scene" && !inc.responders.some(x=>x.commander)){
r.commander=true;
}

// Stop timer if Standing Off or Completed
if((status==="Standing Off" || status==="Completed") && r.status!=="Completed"){
r.elapsed+=Date.now()-r.start;
r.start=null;
}

// Start timer if returning to Active
if(status!=="Standing Off" && status!=="Completed" && r.start===null){
r.start=Date.now();
}

r.status=status;

// If all responders Completed, mark incident completed
if(inc.responders.length>0 && inc.responders.every(x=>x.status==="Completed")){
inc.completed=true;
inc.status="Completed";
}

renderIncidents();
}

// Remove incident
function cancelIncident(id){
incidents=incidents.filter(i=>i.id!==id);
renderIncidents();
}

// Render incidents
function renderIncidents(){
const activeDiv=document.getElementById("incidentBoard");
const completedDiv=document.getElementById("completedBoard");
activeDiv.innerHTML="";
completedDiv.innerHTML="";

incidents.forEach(i=>{
const mapUrl="https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(i.address);
if(i.completed){
completedDiv.innerHTML+=`
<div class="card">
<b>${i.priority}</b> - <a href="${mapUrl}" target="_blank" class="mapLink">${i.address}</a><br>
${i.description}<br>
Contact: ${i.contact}<br>
Responders: ${i.responders.map(r=>`${r.name} (${r.status}${r.commander?" Commander":""})`).join(", ")}<br>
<button class="closeBtn" onclick="cancelIncident(${i.id})">Remove</button>
</div>`;
} else {
// Active incidents
activeDiv.innerHTML+=`
<div class="card">
<b>${i.priority}</b> - <a href="${mapUrl}" target="_blank" class="mapLink">${i.address}</a><br>
${i.description}<br>
Contact: ${i.contact}<br>
Responders: ${i.responders.map(r=>`${r.name} (${r.status}${r.commander?" Commander":""})`).join(", ")}<br>
${responders.map(res=>`
<button class="${statusColor(res,i)}" onclick="responderStatus(${i.id},'${res}','Responding')">${res}:Responding</button>
<button class="${statusColor(res,i)}" onclick="responderStatus(${i.id},'${res}','On Scene')">${res}:On Scene</button>
<button class="${statusColor(res,i)}" onclick="responderStatus(${i.id},'${res}','Standing Off')">${res}:Standing Off</button>
<button class="${statusColor(res,i)}" onclick="responderStatus(${i.id},'${res}','Busy')">${res}:Busy</button>
<button class="${statusColor(res,i)}" onclick="responderStatus(${i.id},'${res}','Completed')">${res}:Completed</button>
`).join("")}
<button class="closeBtn" onclick="cancelIncident(${i.id})">Remove</button>
</div>`;
}
});
}

// Helper to color buttons per current status
function statusColor(res,incident){
const r=incident.responders.find(x=>x.name===res);
if(!r) return "orange";
switch(r.status){
case "Responding": return "orange";
case "On Scene": return "blue";
case "Standing Off": return "red";
case "Busy": return "red";
case "Completed": return "green";
default: return "orange";
}
}

// Update timers every second
setInterval(()=>{
incidents.forEach(i=>{
i.responders.forEach(r=>{
if(r.start) r.elapsed+=1000;
});
});
renderIncidents();
},1000);
</script>
</body>
</html>
