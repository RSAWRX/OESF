<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Incident Command Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Segoe UI;background:#0b1e35;color:white}
header{background:#132c4d;padding:15px;font-size:20px}
.container{display:flex;height:100vh}
.sidebar{width:250px;background:#132c4d;padding:10px}
.sidebar button{width:100%;margin:6px 0;padding:10px;background:#1f3f66;border:none;color:white;cursor:pointer}
.sidebar button:hover{background:#29598f}
.main{flex:1;padding:20px;overflow:auto}
.card{background:#1f3f66;padding:12px;margin:10px 0;border-radius:6px}
input,select,textarea{width:100%;padding:8px;margin:6px 0}
button{border:none;padding:6px 10px;margin:3px;cursor:pointer}
.orange{background:orange;color:white}
.blue{background:#0099ff;color:white}
.red{background:red;color:white}
.green{background:green;color:white}
.closeBtn{background:#444;color:white}
.timer{color:#00e5ff;font-weight:bold}
a.mapLink{color:#00e5ff;text-decoration:none;font-weight:bold}
a.mapLink:hover{text-decoration:underline}
.sectionTitle{margin-top:25px;border-bottom:1px solid #29598f;padding-bottom:5px}
.responder{margin-left:10px;}
.responder b{color:#00e5ff;}
.incDesc{color:#ff5555;font-weight:bold;}
</style>
</head>

<body>

<header>ðŸš¨ Incident Command Center</header>

<div class="container">

<div class="sidebar">
<button onclick="show('dashboard')">Dashboard</button>
<button onclick="show('createIncident')">Create Incident</button>
<button onclick="show('onDuty')">OnDuty Roster</button>
<button onclick="show('signIn')">Sign In</button>
</div>

<div class="main">

<!-- Dashboard Section -->
<section id="dashboard">
<h2 class="sectionTitle">Active Incidents</h2>
<div id="incidentBoard"></div>

<h2 class="sectionTitle">Completed Incidents</h2>
<div id="completedBoard"></div>
</section>

<!-- Create Incident Section -->
<section id="createIncident">
<h2>Create Incident</h2>
<input id="address" placeholder="Address">
<input id="description" placeholder="Description">
<input id="contact" placeholder="Contact On Scene">
<select id="priority">
<option>Low</option>
<option>Medium</option>
<option>High</option>
<option>Critical</option>
</select>
<button onclick="createIncident()">Create Incident</button>
</section>

<!-- OnDuty Roster Section -->
<section id="onDuty">
<h2 class="sectionTitle">OnDuty Roster</h2>
<div id="rosterBoard"></div>
</section>

<!-- Sign In Section -->
<section id="signIn">
<h2>Sign In</h2>
<input id="userName" placeholder="Name">
<input id="vehicle" placeholder="Vehicle (Make/Color/Reg)">
<button onclick="signInUser()">Sign In</button>
</section>

</div>
</div>

<script>
// --- Core data ---
let incidents = [];
let users = [];

// --- Show section ---
function show(id){
document.querySelectorAll("section").forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
}

// --- Sign In ---
function signInUser(){
const name = userName.value.trim();
const vehicle = vehicle.value.trim();
if(!name){ alert("Enter name"); return; }
// prevent duplicate sign-ins
if(users.some(u=>u.name===name)){ alert("Already signed in"); return; }
const newUser = {name, vehicle, status:"Available"};
users.push(newUser);
userName.value=""; vehicle.value="";
alert(`${name} signed in!`);
renderRoster();
// Automatically go to dashboard after signing in
show("dashboard");
renderIncidents();
}

// --- Render OnDuty Roster ---
function renderRoster(){
const rosterDiv = document.getElementById("rosterBoard");
rosterDiv.innerHTML="";
users.forEach(u=>{
rosterDiv.innerHTML+=`<div class="card"><b>${u.name}</b> - ${u.vehicle} | ${u.status}</div>`;
});
}

// --- Create Incident ---
function createIncident(){
if(!address.value || !description.value){ alert("Enter address & description"); return; }
const incident = {
id:Date.now(),
address:address.value,
description:description.value,
contact:contact.value,
priority:priority.value,
created:Date.now(),
status:"Active",
responders:[],
completed:false
};
incidents.unshift(incident); // newest first
address.value=""; description.value=""; contact.value="";
renderIncidents();
show("dashboard");
}

// --- Responder Status ---
function responderStatus(incidentId,responderName,status){
const inc = incidents.find(i=>i.id===incidentId);
const user = users.find(u=>u.name===responderName);
if(!inc || !user) return;

// Check if responder already assigned
let r = inc.responders.find(x=>x.name===responderName);
if(!r){
r={name:responderName,status:"Responding",start:Date.now(),elapsed:0,commander:false};
inc.responders.push(r);
}

// First to go On Scene â†’ Commander
if(status==="On Scene" && !inc.responders.some(x=>x.commander)){
r.commander=true;
}

// Stop timer if Standing Off or Completed
if((status==="Standing Off" || status==="Completed") && r.status!=="Completed"){
r.elapsed+=Date.now()-r.start;
r.start=null;
}

// Start timer if returning to active
if(status!=="Standing Off" && status!=="Completed" && r.start===null){
r.start=Date.now();
}

r.status=status;

// Update user status in roster
user.status=status;

// If all responders Completed, mark incident completed
if(inc.responders.length>0 && inc.responders.every(x=>x.status==="Completed")){
inc.completed=true;
inc.status="Completed";
}

renderRoster();
renderIncidents();
}

// --- Remove incident ---
function cancelIncident(id){
incidents = incidents.filter(i=>i.id!==id);
renderIncidents();
}

// --- Status color helper ---
function statusColor(r){
switch(r){
case "Responding": return "orange";
case "On Scene": return "blue";
case "Standing Off": return "red";
case "Busy": return "red";
case "Completed": return "green";
default: return "orange";
}
}

// --- Render incidents ---
function renderIncidents(){
const activeDiv = document.getElementById("incidentBoard");
const completedDiv = document.getElementById("completedBoard");
activeDiv.innerHTML=""; completedDiv.innerHTML="";

incidents.forEach(i=>{
const mapUrl="https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(i.address);

if(i.completed){
completedDiv.innerHTML+=`
<div class="card">
<b>${i.priority}</b> - <a href="${mapUrl}" target="_blank" class="mapLink">${i.address}</a><br>
<span class="incDesc">${i.description}</span><br>
Contact: ${i.contact}<br>
Responders: ${i.responders.map(r=>`${r.name} (<span style="color:${statusColor(r.status)}">${r.status}${r.commander?" Commander":""}</span>)`).join(", ")}<br>
<button class="closeBtn" onclick="cancelIncident(${i.id})">Remove</button>
</div>`;
}else{
activeDiv.innerHTML+=`
<div class="card">
<b>${i.priority}</b> - <a href="${mapUrl}" target="_blank" class="mapLink">${i.address}</a><br>
<span class="incDesc">${i.description}</span><br>
Contact: ${i.contact}<br>
Responder: 
<select onchange="responderStatus(${i.id},this.value,this.options[this.selectedIndex].text)">
<option disabled selected>Select Responder</option>
${users.map(u=>`<option>${u.name}</option>`).join("")}
</select><br>
${i.responders.map(r=>`${r.name} (<span style="color:${statusColor(r.status)}">${r.status}${r.commander?" Commander":""}</span>)`).join(", ")}<br>
<button class="closeBtn" onclick="cancelIncident(${i.id})">Remove</button>
</div>`;
}
}

// Update timers every second
setInterval(()=>{
incidents.forEach(i=>{
i.responders.forEach(r=>{
if(r.start) r.elapsed+=1000;
});
});
renderIncidents();
},1000);

// --- Init ---
show("dashboard");
renderRoster();
renderIncidents();

</script>
</body>
</html>
