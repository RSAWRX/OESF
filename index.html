<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Incident Command Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:#0b1e35;
    color:white;
}
header{
    background:#132c4d;
    padding:15px;
    font-size:20px;
}
.container{
    display:flex;
    height:100vh;
}
.sidebar{
    width:220px;
    background:#132c4d;
    padding:10px;
}
.sidebar button{
    width:100%;
    margin:6px 0;
    padding:10px;
    background:#1f3f66;
    border:none;
    color:white;
    cursor:pointer;
}
.sidebar button:hover{
    background:#29598f;
}
.main{
    flex:1;
    padding:20px;
    overflow:auto;
}
.card{
    background:#1f3f66;
    padding:12px;
    margin:10px 0;
    border-radius:6px;
}
input,select{
    width:100%;
    padding:8px;
    margin:6px 0;
}
button.action{
    padding:6px 10px;
    margin:3px 3px 3px 0;
    border:none;
    cursor:pointer;
}
.orange{background:orange;color:white;}
.blue{background:#0099ff;color:white;}
.red{background:red;color:white;}
.green{background:green;color:white;}
.closeBtn{background:#444;color:white;}
.incDesc{
    color:#ff4444;
    font-weight:bold;
}
.sectionTitle{
    margin-top:25px;
    border-bottom:1px solid #29598f;
    padding-bottom:5px;
}
a.mapLink{
    color:#00e5ff;
    font-weight:bold;
    text-decoration:none;
}
a.mapLink:hover{
    text-decoration:underline;
}
section{display:none;}
.timer{
    color:#00e5ff;
    font-weight:bold;
}
</style>
</head>

<body>

<header>Dispatch Command Center</header>

<div class="container">

<div class="sidebar">
    <button onclick="show('dashboard')">Dashboard</button>
    <button onclick="show('createIncident')">Create Incident</button>
</div>

<div class="main">

<!-- DASHBOARD -->
<section id="dashboard">

<h2 class="sectionTitle">Active Incidents</h2>
<div id="activeIncidents"></div>

<h2 class="sectionTitle">Completed Incidents</h2>
<div id="completedIncidents"></div>

</section>

<!-- CREATE INCIDENT -->
<section id="createIncident">
<h2>Create Incident</h2>

<input id="address" placeholder="Address">
<input id="description" placeholder="Description">
<input id="contact" placeholder="Contact On Scene">

<select id="priority">
<option>Low</option>
<option>Medium</option>
<option>High</option>
<option>Critical</option>
</select>

<button onclick="createIncident()">Create Incident</button>

</section>

</div>
</div>

<script>

let incidents = [];

// NAVIGATION
function show(id){
    document.querySelectorAll("section").forEach(sec=>sec.style.display="none");
    document.getElementById(id).style.display="block";
}

// CREATE INCIDENT
function createIncident(){
    if(!address.value || !description.value){
        alert("Address and Description required");
        return;
    }

    const incident = {
        id: Date.now(),
        address: address.value,
        description: description.value,
        contact: contact.value,
        priority: priority.value,
        status: "Active",
        responders: [],
        created: Date.now()
    };

    incidents.unshift(incident);

    address.value="";
    description.value="";
    contact.value="";

    render();
    show("dashboard");
}

// RESPONDER STATUS
function updateStatus(incidentId, status){
    const inc = incidents.find(i=>i.id===incidentId);
    if(!inc) return;

    let responder = inc.responders[0];

    if(!responder){
        responder = {
            status: status,
            start: Date.now(),
            elapsed: 0
        };
        inc.responders.push(responder);
    }

    if(status === "Standing Off" || status === "Completed"){
        if(responder.start){
            responder.elapsed += Date.now() - responder.start;
            responder.start = null;
        }
    } else {
        if(!responder.start){
            responder.start = Date.now();
        }
    }

    responder.status = status;

    if(status === "Completed"){
        inc.status = "Completed";
    }

    render();
}

// TIMER FORMAT
function formatTime(ms){
    const totalSec = Math.floor(ms/1000);
    const min = Math.floor(totalSec/60);
    const sec = totalSec % 60;
    return `${min}m ${sec}s`;
}

// REMOVE INCIDENT
function removeIncident(id){
    incidents = incidents.filter(i=>i.id!==id);
    render();
}

// RENDER
function render(){
    const activeDiv = document.getElementById("activeIncidents");
    const completedDiv = document.getElementById("completedIncidents");

    activeDiv.innerHTML="";
    completedDiv.innerHTML="";

    incidents.forEach(i=>{

        const mapUrl = "https://www.google.com/maps/search/?api=1&query=" 
        + encodeURIComponent(i.address);

        const responder = i.responders[0];

        let timerDisplay = "";
        if(responder){
            let total = responder.elapsed;
            if(responder.start){
                total += Date.now() - responder.start;
            }
            timerDisplay = `<div class="timer">Time: ${formatTime(total)}</div>`;
        }

        const card = `
        <div class="card">
            <b>${i.priority}</b> -
            <a href="${mapUrl}" target="_blank" class="mapLink">${i.address}</a>
            <br>
            <span class="incDesc">${i.description}</span><br>
            Contact: ${i.contact || "N/A"}<br>
            Status: ${responder ? responder.status : "Not Assigned"}<br>
            ${timerDisplay}

            <select onchange="updateStatus(${i.id}, this.value)">
                <option disabled selected>Update Status</option>
                <option>Responding</option>
                <option>On Scene</option>
                <option>Standing Off</option>
                <option>Completed</option>
            </select>

            <button class="action closeBtn" onclick="removeIncident(${i.id})">
                Remove
            </button>
        </div>
        `;

        if(i.status === "Completed"){
            completedDiv.innerHTML += card;
        } else {
            activeDiv.innerHTML += card;
        }

    });
}

// TIMER REFRESH
setInterval(render,1000);

// INIT
show("dashboard");
render();

</script>

</body>
</html>
