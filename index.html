<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Incident Command Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Segoe UI;background:#0b1e35;color:white;}
header{background:#132c4d;padding:15px;font-size:20px;}
.container{display:flex;height:100vh;}
.sidebar{width:220px;background:#132c4d;padding:10px;}
.sidebar button{width:100%;margin:6px 0;padding:10px;background:#1f3f66;border:none;color:white;cursor:pointer;}
.sidebar button:hover{background:#29598f;}
.main{flex:1;padding:20px;overflow:auto;}
.card{background:#1f3f66;padding:12px;margin:10px 0;border-radius:6px;}
input,select{width:100%;padding:8px;margin:6px 0;}
button.action{padding:6px 10px;margin:4px 4px 4px 0;border:none;cursor:pointer;border-radius:4px;}
.orange{background:orange;color:white;}
.blue{background:#0099ff;color:white;}
.red{background:red;color:white;}
.green{background:green;color:white;}
.closeBtn{background:#444;color:white;}
.incDesc{color:#ff4444;font-weight:bold;}
.sectionTitle{margin-top:25px;border-bottom:1px solid #29598f;padding-bottom:5px;}
a.mapLink{color:#00e5ff;font-weight:bold;text-decoration:none;}
a.mapLink:hover{text-decoration:underline;}
section{display:none;}
.timer{color:#00e5ff;font-weight:bold;}
.statusButtons{margin-top:8px;}
</style>
</head>

<body>

<header>ðŸš¨ Incident Command Center</header>

<div class="container">
<div class="sidebar">
<button onclick="show('dashboard')">Dashboard</button>
<button onclick="show('createIncident')">Create Incident</button>
</div>

<div class="main">

<section id="dashboard">
<h2 class="sectionTitle">Active Incidents</h2>
<div id="activeIncidents"></div>

<h2 class="sectionTitle">Completed Incidents</h2>
<div id="completedIncidents"></div>
</section>

<section id="createIncident">
<h2>Create Incident</h2>
<input id="address" placeholder="Address">
<input id="description" placeholder="Description">
<input id="contact" placeholder="Contact On Scene">
<select id="priority">
<option>Low</option>
<option>Medium</option>
<option>High</option>
<option>Critical</option>
</select>
<button onclick="createIncident()">Create Incident</button>
</section>

</div>
</div>

<script>

let incidents = [];

/* =========================
   LOCAL STORAGE FUNCTIONS
========================= */

function saveData(){
    localStorage.setItem("incidentsData", JSON.stringify(incidents));
}

function loadData(){
    const data = localStorage.getItem("incidentsData");
    if(data){
        incidents = JSON.parse(data);
    }
}

/* =========================
   NAVIGATION
========================= */

function show(id){
    document.querySelectorAll("section").forEach(sec=>sec.style.display="none");
    document.getElementById(id).style.display="block";
}

/* =========================
   CREATE INCIDENT
========================= */

function createIncident(){
    if(!address.value || !description.value){
        alert("Address and Description required");
        return;
    }

    const incident = {
        id: Date.now(),
        address: address.value,
        description: description.value,
        contact: contact.value,
        priority: priority.value,
        status: "Active",
        responder: null
    };

    incidents.unshift(incident);

    address.value="";
    description.value="";
    contact.value="";

    saveData();
    render();
    show("dashboard");
}

/* =========================
   UPDATE STATUS
========================= */

function updateStatus(id, status){
    const inc = incidents.find(i=>i.id===id);
    if(!inc) return;

    if(!inc.responder){
        inc.responder = {
            status: status,
            start: Date.now(),
            elapsed: 0
        };
    }

    if(status === "Standing Off" || status === "Completed"){
        if(inc.responder.start){
            inc.responder.elapsed += Date.now() - inc.responder.start;
            inc.responder.start = null;
        }
    } else {
        if(!inc.responder.start){
            inc.responder.start = Date.now();
        }
    }

    inc.responder.status = status;

    if(status === "Completed"){
        inc.status = "Completed";
    }

    saveData();
    render();
}

/* =========================
   REMOVE INCIDENT
========================= */

function removeIncident(id){
    incidents = incidents.filter(i=>i.id!==id);
    saveData();
    render();
}

/* =========================
   TIMER FORMAT
========================= */

function formatTime(ms){
    const total = Math.floor(ms/1000);
    const m = Math.floor(total/60);
    const s = total % 60;
    return `${m}m ${s}s`;
}

/* =========================
   RENDER
========================= */

function render(){
    const activeDiv = document.getElementById("activeIncidents");
    const completedDiv = document.getElementById("completedIncidents");

    activeDiv.innerHTML="";
    completedDiv.innerHTML="";

    incidents.forEach(i=>{

        const mapUrl = "https://www.google.com/maps/search/?api=1&query=" 
        + encodeURIComponent(i.address);

        let timerDisplay="";
        let statusText="Not Assigned";

        if(i.responder){
            let total=i.responder.elapsed;

            if(i.responder.start){
                total += Date.now() - i.responder.start;
            }

            timerDisplay=`<div class="timer">Time: ${formatTime(total)}</div>`;
            statusText=i.responder.status;
        }

        const card=`
        <div class="card">
            <b>${i.priority}</b> -
            <a href="${mapUrl}" target="_blank" class="mapLink">${i.address}</a><br>

            <span class="incDesc">${i.description}</span><br>
            Contact: ${i.contact || "N/A"}<br>
            Status: ${statusText}
            ${timerDisplay}

            ${i.status!=="Completed" ? `
            <div class="statusButtons">
                <button class="action orange" onclick="updateStatus(${i.id},'Responding')">Responding</button>
                <button class="action blue" onclick="updateStatus(${i.id},'Busy')">On Scene</button>
                <button class="action red" onclick="updateStatus(${i.id},'Standing Off')">Standing Off</button>
                <button class="action green" onclick="updateStatus(${i.id},'Completed')">Completed</button>
            </div>
            ` : ""}

            <br>
            <button class="action closeBtn" onclick="removeIncident(${i.id})">Remove</button>
        </div>
        `;

        if(i.status==="Completed"){
            completedDiv.innerHTML+=card;
        } else{
            activeDiv.innerHTML+=card;
        }

    });
}

/* =========================
   AUTO TIMER REFRESH
========================= */

setInterval(render,1000);

/* =========================
   INIT
========================= */

loadData();
show("dashboard");
render();

</script>

</body>
</html>
